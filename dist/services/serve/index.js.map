{"version":3,"sources":["../../../src/services/serve/index.js"],"names":["router","express","Router","sitePath","opts","get","req","res","targetPath","originalUrl","split","target","path","join","stat","fs","statSync","isFile","sendFile","err","spa","errno","__dirname","send"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AAEA,MAAMA,SAASC,kBAAQC,MAAR,EAAf;;kBAEe,CAACC,QAAD,EAAWC,IAAX,KAAoB;;AAElCJ,QAAOK,GAAP,CAAW,GAAX,EAAgB,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AACnC,QAAMC,aAAaF,IAAIG,WAAJ,CAAgBC,KAAhB,CAAsB,GAAtB,EAA2B,CAA3B,CAAnB;AACA,MAAI;AACH,SAAMC,SAASC,eAAKC,IAAL,CAAUV,QAAV,EAAoBK,UAApB,CAAf;AACA,SAAMM,OAAO,MAAMC,aAAGC,QAAH,CAAYL,MAAZ,CAAnB;AACA,OAAGG,KAAKG,MAAL,EAAH,EAAkB;AACjB,WAAOV,IAAIW,QAAJ,CAAaP,MAAb,CAAP;AACA,IAFD,MAGI;AACH,QAAGH,eAAe,GAAlB,EAAuB;AACtB,YAAOD,IAAIW,QAAJ,CAAaN,eAAKC,IAAL,CAAUV,QAAV,EAAqB,YAArB,CAAb,CAAP;AACA;AACD,WAAOI,IAAIW,QAAJ,CAAaN,eAAKC,IAAL,CAAUV,QAAV,EAAqB,GAAEK,UAAW,OAAlC,CAAb,CAAP;AACA;AACD,GAZD,CAYE,OAAMW,GAAN,EAAW;AACZ,OAAGf,KAAKgB,GAAL,IAAY,IAAf,EAAqB;AACpB,WAAOb,IAAIW,QAAJ,CAAaN,eAAKC,IAAL,CAAUV,QAAV,EAAqB,YAArB,CAAb,CAAP;AACA;AACD,OAAGgB,IAAIE,KAAJ,IAAa,CAAC,CAAjB,EAAoB;AACnB,WAAOd,IAAIW,QAAJ,CAAaN,eAAKC,IAAL,CAAUS,SAAV,EAAqB,IAArB,EAA2B,IAA3B,EAAiC,OAAjC,EAA0C,kBAA1C,CAAb,CAAP;AACA;AACD,UAAOf,IAAIgB,IAAJ,CAASJ,GAAT,CAAP;AACA;AACD,EAvBD;;AAyBA,QAAOnB,MAAP;AACA,C","file":"index.js","sourcesContent":["import express from 'express'\nimport path from 'path'\nimport fs from 'fs'\n\nconst router = express.Router()\n\nexport default (sitePath, opts) => {\n\t\n\trouter.get('*', async (req, res) => {\n\t\tconst targetPath = req.originalUrl.split('?')[0]\n\t\ttry {\n\t\t\tconst target = path.join(sitePath, targetPath)\n\t\t\tconst stat = await fs.statSync(target)\n\t\t\tif(stat.isFile()) {\n\t\t\t\treturn res.sendFile(target)\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif(targetPath === '/') {\n\t\t\t\t\treturn res.sendFile(path.join(sitePath, `index.html`))\n\t\t\t\t}\n\t\t\t\treturn res.sendFile(path.join(sitePath, `${targetPath}.html`))\n\t\t\t}\n\t\t} catch(err) {\n\t\t\tif(opts.spa == true) {\n\t\t\t\treturn res.sendFile(path.join(sitePath, `index.html`))\n\t\t\t}\n\t\t\tif(err.errno == -2) {\n\t\t\t\treturn res.sendFile(path.join(__dirname, '..', '..', 'views', 'default-404.html'))\n\t\t\t}\n\t\t\treturn res.send(err)\n\t\t}\n\t})\n\n\treturn router\n}"]}